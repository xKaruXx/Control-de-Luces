<!DOCTYPE HTML>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configuración Avanzada - Control de Luces</title>
  <link rel="stylesheet" href="https://adminlte.io/themes/v3/plugins/fontawesome-free/css/all.min.css">
  <link rel="stylesheet" href="https://adminlte.io/themes/v3/dist/css/adminlte.min.css">
  <style>
    .nav-tabs .nav-link.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .schedule-card {
      border-left: 4px solid #667eea;
      margin-bottom: 10px;
    }
    .zone-card {
      border-left: 4px solid #43e97b;
      margin-bottom: 10px;
    }
    .alert-card {
      border-left: 4px solid #f093fb;
      margin-bottom: 10px;
    }
    .time-picker {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .day-selector {
      display: flex;
      gap: 5px;
    }
    .day-selector label {
      padding: 5px 10px;
      border: 1px solid #ddd;
      border-radius: 3px;
      cursor: pointer;
    }
    .day-selector input:checked + label {
      background: #667eea;
      color: white;
    }
  </style>
</head>
<body class="hold-transition sidebar-mini">
  <div class="wrapper">
    <header class="main-header">
      <nav class="navbar navbar-expand navbar-dark">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="#"><i class="fas fa-bars"></i></a>
          </li>
          <li class="nav-item d-none d-sm-inline-block">
            <a href="/" class="nav-link">Inicio</a>
          </li>
        </ul>
      </nav>
    </header>
    
    <aside class="main-sidebar elevation-4">
      <a href="/" class="brand-link">
        <span class="brand-text font-weight-light">Control de Luces</span>
      </a>
      <div class="sidebar">
        <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" role="menu">
            <li class="nav-item">
              <a href="/" class="nav-link">
                <i class="nav-icon fas fa-map"></i>
                <p>Mapa</p>
              </a>
            </li>
            <li class="nav-item">
              <a href="/diagnostico.html" class="nav-link">
                <i class="nav-icon fas fa-stethoscope"></i>
                <p>Diagnóstico</p>
              </a>
            </li>
            <li class="nav-item">
              <a href="/configuracion.html" class="nav-link active">
                <i class="nav-icon fas fa-cogs"></i>
                <p>Configuración</p>
              </a>
            </li>
          </ul>
        </nav>
      </div>
    </aside>
    
    <div class="content-wrapper">
      <div class="content-header">
        <div class="container-fluid">
          <h1 class="m-0 text-dark">Configuración Avanzada</h1>
        </div>
      </div>
      
      <div class="content">
        <div class="container-fluid">
          <!-- Tabs -->
          <ul class="nav nav-tabs" id="configTabs" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" id="schedule-tab" data-toggle="tab" href="#schedule" role="tab">
                <i class="fas fa-clock"></i> Programación Horaria
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="zones-tab" data-toggle="tab" href="#zones" role="tab">
                <i class="fas fa-object-group"></i> Zonas
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="alerts-tab" data-toggle="tab" href="#alerts" role="tab">
                <i class="fas fa-bell"></i> Alertas
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="consumption-tab" data-toggle="tab" href="#consumption" role="tab">
                <i class="fas fa-bolt"></i> Consumo
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="export-tab" data-toggle="tab" href="#export" role="tab">
                <i class="fas fa-download"></i> Exportar
              </a>
            </li>
          </ul>
          
          <div class="tab-content mt-3" id="configTabContent">
            <!-- TAB: Programación Horaria -->
            <div class="tab-pane fade show active" id="schedule" role="tabpanel">
              <div class="row">
                <div class="col-md-8">
                  <div class="card">
                    <div class="card-header">
                      <h3 class="card-title">Programaciones Activas</h3>
                      <div class="card-tools">
                        <button class="btn btn-sm btn-primary" onclick="showAddSchedule()">
                          <i class="fas fa-plus"></i> Nueva Programación
                        </button>
                      </div>
                    </div>
                    <div class="card-body" id="scheduleList">
                      <!-- Se llena dinámicamente -->
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card">
                    <div class="card-header">
                      <h3 class="card-title">Información Solar</h3>
                    </div>
                    <div class="card-body">
                      <p><i class="fas fa-sun"></i> Amanecer: <strong id="sunrise">06:30</strong></p>
                      <p><i class="fas fa-moon"></i> Atardecer: <strong id="sunset">18:30</strong></p>
                      <hr>
                      <button class="btn btn-success btn-block" onclick="createNightSchedule()">
                        <i class="fas fa-moon"></i> Crear Horario Nocturno
                      </button>
                      <button class="btn btn-warning btn-block" onclick="createWeekendSchedule()">
                        <i class="fas fa-calendar-week"></i> Crear Horario Fin de Semana
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- TAB: Zonas -->
            <div class="tab-pane fade" id="zones" role="tabpanel">
              <div class="row">
                <div class="col-md-8">
                  <div class="card">
                    <div class="card-header">
                      <h3 class="card-title">Zonas Configuradas</h3>
                      <div class="card-tools">
                        <button class="btn btn-sm btn-primary" onclick="showAddZone()">
                          <i class="fas fa-plus"></i> Nueva Zona
                        </button>
                      </div>
                    </div>
                    <div class="card-body" id="zoneList">
                      <!-- Se llena dinámicamente -->
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card">
                    <div class="card-header">
                      <h3 class="card-title">Estadísticas de Zonas</h3>
                    </div>
                    <div class="card-body">
                      <p>Total Zonas: <strong id="totalZones">0</strong></p>
                      <p>Luminarias Asignadas: <strong id="assignedLights">0</strong></p>
                      <p>Consumo Total: <strong id="totalZoneConsumption">0</strong> kWh</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- TAB: Alertas -->
            <div class="tab-pane fade" id="alerts" role="tabpanel">
              <div class="row">
                <div class="col-md-8">
                  <div class="card">
                    <div class="card-header">
                      <h3 class="card-title">Alertas Activas</h3>
                      <div class="card-tools">
                        <span class="badge badge-danger" id="alertCount">0</span>
                        <button class="btn btn-sm btn-warning ml-2" onclick="acknowledgeAllAlerts()">
                          <i class="fas fa-check"></i> Reconocer Todas
                        </button>
                      </div>
                    </div>
                    <div class="card-body" id="alertList">
                      <!-- Se llena dinámicamente -->
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card">
                    <div class="card-header">
                      <h3 class="card-title">Configuración de Alertas</h3>
                    </div>
                    <div class="card-body">
                      <div class="form-group">
                        <label>Umbral Consumo Alto (W)</label>
                        <input type="number" class="form-control" id="highConsumption" value="150">
                      </div>
                      <div class="form-group">
                        <label>Umbral Consumo Bajo (W)</label>
                        <input type="number" class="form-control" id="lowConsumption" value="10">
                      </div>
                      <div class="form-group">
                        <label>Timeout Offline (min)</label>
                        <input type="number" class="form-control" id="offlineTimeout" value="5">
                      </div>
                      <button class="btn btn-primary btn-block" onclick="saveAlertConfig()">
                        <i class="fas fa-save"></i> Guardar Configuración
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- TAB: Consumo -->
            <div class="tab-pane fade" id="consumption" role="tabpanel">
              <div class="row">
                <div class="col-md-12">
                  <div class="card">
                    <div class="card-header">
                      <h3 class="card-title">Consumo Energético</h3>
                      <div class="card-tools">
                        <button class="btn btn-sm btn-info" onclick="refreshConsumption()">
                          <i class="fas fa-sync"></i> Actualizar
                        </button>
                      </div>
                    </div>
                    <div class="card-body">
                      <div class="row">
                        <div class="col-md-3">
                          <div class="info-box">
                            <span class="info-box-icon bg-warning"><i class="fas fa-bolt"></i></span>
                            <div class="info-box-content">
                              <span class="info-box-text">Consumo Actual</span>
                              <span class="info-box-number" id="currentPower">0 W</span>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-3">
                          <div class="info-box">
                            <span class="info-box-icon bg-info"><i class="fas fa-chart-line"></i></span>
                            <div class="info-box-content">
                              <span class="info-box-text">Consumo 24h</span>
                              <span class="info-box-number" id="consumption24h">0 kWh</span>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-3">
                          <div class="info-box">
                            <span class="info-box-icon bg-success"><i class="fas fa-dollar-sign"></i></span>
                            <div class="info-box-content">
                              <span class="info-box-text">Costo Estimado</span>
                              <span class="info-box-number" id="estimatedCost">$0</span>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-3">
                          <div class="info-box">
                            <span class="info-box-icon bg-danger"><i class="fas fa-leaf"></i></span>
                            <div class="info-box-content">
                              <span class="info-box-text">CO2 Emitido</span>
                              <span class="info-box-number" id="co2Emissions">0 kg</span>
                            </div>
                          </div>
                        </div>
                      </div>
                      <canvas id="consumptionChart" height="100"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- TAB: Exportar -->
            <div class="tab-pane fade" id="export" role="tabpanel">
              <div class="row">
                <div class="col-md-6">
                  <div class="card">
                    <div class="card-header">
                      <h3 class="card-title">Exportar Datos</h3>
                    </div>
                    <div class="card-body">
                      <div class="form-group">
                        <label>Tipo de Datos</label>
                        <select class="form-control" id="exportType">
                          <option value="events">Eventos</option>
                          <option value="schedules">Programaciones</option>
                          <option value="zones">Zonas</option>
                          <option value="consumption">Consumo</option>
                          <option value="alerts">Alertas</option>
                        </select>
                      </div>
                      <div class="form-group">
                        <label>Formato</label>
                        <select class="form-control" id="exportFormat">
                          <option value="csv">CSV</option>
                          <option value="json">JSON</option>
                        </select>
                      </div>
                      <button class="btn btn-primary btn-block" onclick="exportData()">
                        <i class="fas fa-download"></i> Descargar
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card">
                    <div class="card-header">
                      <h3 class="card-title">Backup del Sistema</h3>
                    </div>
                    <div class="card-body">
                      <p>Último backup: <strong id="lastBackup">Nunca</strong></p>
                      <button class="btn btn-success btn-block" onclick="createBackup()">
                        <i class="fas fa-save"></i> Crear Backup Ahora
                      </button>
                      <button class="btn btn-warning btn-block" onclick="restoreBackup()">
                        <i class="fas fa-undo"></i> Restaurar Backup
                      </button>
                      <hr>
                      <div class="custom-control custom-switch">
                        <input type="checkbox" class="custom-control-input" id="autoBackup" checked>
                        <label class="custom-control-label" for="autoBackup">
                          Backup Automático (cada hora)
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <footer class="main-footer">
      <strong>Control de Luces - San Luis &copy; 2024</strong>
      <div class="float-right">
        Versión: 0.5.0
      </div>
    </footer>
  </div>
  
  <!-- Modal Nueva Programación -->
  <div class="modal fade" id="addScheduleModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Nueva Programación</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Nombre</label>
            <input type="text" class="form-control" id="scheduleName" placeholder="Ej: Horario Nocturno">
          </div>
          <div class="form-group">
            <label>Hora Encendido</label>
            <div class="time-picker">
              <input type="number" class="form-control" id="hourOn" min="0" max="23" value="18">
              <span>:</span>
              <input type="number" class="form-control" id="minuteOn" min="0" max="59" value="0">
            </div>
          </div>
          <div class="form-group">
            <label>Hora Apagado</label>
            <div class="time-picker">
              <input type="number" class="form-control" id="hourOff" min="0" max="23" value="6">
              <span>:</span>
              <input type="number" class="form-control" id="minuteOff" min="0" max="59" value="0">
            </div>
          </div>
          <div class="form-group">
            <label>Días de la Semana</label>
            <div class="day-selector">
              <input type="checkbox" id="day0" hidden>
              <label for="day0">D</label>
              <input type="checkbox" id="day1" hidden checked>
              <label for="day1">L</label>
              <input type="checkbox" id="day2" hidden checked>
              <label for="day2">M</label>
              <input type="checkbox" id="day3" hidden checked>
              <label for="day3">M</label>
              <input type="checkbox" id="day4" hidden checked>
              <label for="day4">J</label>
              <input type="checkbox" id="day5" hidden checked>
              <label for="day5">V</label>
              <input type="checkbox" id="day6" hidden>
              <label for="day6">S</label>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" onclick="saveSchedule()">Guardar</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal Nueva Zona -->
  <div class="modal fade" id="addZoneModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title">Nueva Zona</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Nombre</label>
            <input type="text" class="form-control" id="zoneName" placeholder="Ej: Centro">
          </div>
          <div class="form-group">
            <label>Descripción</label>
            <textarea class="form-control" id="zoneDescription" rows="3"></textarea>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary" onclick="saveZone()">Guardar</button>
        </div>
      </div>
    </div>
  </div>
  
  <script src="https://adminlte.io/themes/v3/plugins/jquery/jquery.min.js"></script>
  <script src="https://adminlte.io/themes/v3/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="https://adminlte.io/themes/v3/dist/js/adminlte.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <script>
    let consumptionChart;
    const authToken = localStorage.getItem('authToken') || sessionStorage.getItem('authToken');
    
    // Inicializar
    $(document).ready(function() {
      if (!authToken) {
        window.location.href = '/login.html';
        return;
      }
      
      loadSchedules();
      loadZones();
      loadAlerts();
      loadConsumption();
      initConsumptionChart();
    });
    
    // === PROGRAMACIÓN HORARIA ===
    
    function loadSchedules() {
      fetch('/api/schedules', {
        headers: { 'Authorization': 'Bearer ' + authToken }
      })
      .then(response => response.json())
      .then(schedules => {
        let html = '';
        schedules.forEach(schedule => {
          html += `
            <div class="card schedule-card">
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <h5>${schedule.name}</h5>
                    <p><i class="fas fa-clock"></i> ${schedule.hourOn}:${schedule.minuteOn} - ${schedule.hourOff}:${schedule.minuteOff}</p>
                  </div>
                  <div class="col-md-6 text-right">
                    <div class="custom-control custom-switch">
                      <input type="checkbox" class="custom-control-input" id="schedule${schedule.id}" 
                             ${schedule.enabled ? 'checked' : ''} 
                             onchange="toggleSchedule(${schedule.id}, this.checked)">
                      <label class="custom-control-label" for="schedule${schedule.id}">Activo</label>
                    </div>
                    <button class="btn btn-sm btn-danger mt-2" onclick="deleteSchedule(${schedule.id})">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `;
        });
        $('#scheduleList').html(html || '<p class="text-muted">No hay programaciones configuradas</p>');
      });
    }
    
    function showAddSchedule() {
      $('#addScheduleModal').modal('show');
    }
    
    function saveSchedule() {
      const name = $('#scheduleName').val();
      const hourOn = $('#hourOn').val();
      const minuteOn = $('#minuteOn').val();
      const hourOff = $('#hourOff').val();
      const minuteOff = $('#minuteOff').val();
      
      let daysOfWeek = 0;
      for (let i = 0; i < 7; i++) {
        if ($('#day' + i).is(':checked')) {
          daysOfWeek |= (1 << i);
        }
      }
      
      fetch('/api/schedules/add', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + authToken,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          name, hourOn, minuteOn, hourOff, minuteOff, daysOfWeek
        })
      })
      .then(response => response.json())
      .then(data => {
        $('#addScheduleModal').modal('hide');
        loadSchedules();
      });
    }
    
    function toggleSchedule(id, enabled) {
      fetch(`/api/schedules/${id}/enable`, {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + authToken,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ enabled })
      });
    }
    
    function deleteSchedule(id) {
      if (confirm('¿Eliminar esta programación?')) {
        fetch(`/api/schedules/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': 'Bearer ' + authToken }
        })
        .then(() => loadSchedules());
      }
    }
    
    // === ZONAS ===
    
    function loadZones() {
      fetch('/api/zones', {
        headers: { 'Authorization': 'Bearer ' + authToken }
      })
      .then(response => response.json())
      .then(zones => {
        let html = '';
        let totalLights = 0;
        zones.forEach(zone => {
          totalLights += zone.luminarias;
          html += `
            <div class="card zone-card">
              <div class="card-body">
                <h5>${zone.name}</h5>
                <p>${zone.description}</p>
                <p><i class="fas fa-lightbulb"></i> ${zone.luminarias} luminarias</p>
                <button class="btn btn-sm btn-danger" onclick="deleteZone(${zone.id})">
                  <i class="fas fa-trash"></i> Eliminar
                </button>
              </div>
            </div>
          `;
        });
        $('#zoneList').html(html || '<p class="text-muted">No hay zonas configuradas</p>');
        $('#totalZones').text(zones.length);
        $('#assignedLights').text(totalLights);
      });
    }
    
    function showAddZone() {
      $('#addZoneModal').modal('show');
    }
    
    function saveZone() {
      const name = $('#zoneName').val();
      const description = $('#zoneDescription').val();
      
      fetch('/api/zones/add', {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + authToken,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ name, description })
      })
      .then(response => response.json())
      .then(data => {
        $('#addZoneModal').modal('hide');
        loadZones();
      });
    }
    
    // === ALERTAS ===
    
    function loadAlerts() {
      fetch('/api/alerts', {
        headers: { 'Authorization': 'Bearer ' + authToken }
      })
      .then(response => response.json())
      .then(alerts => {
        let html = '';
        let unacknowledged = 0;
        
        alerts.forEach(alert => {
          if (!alert.acknowledged) unacknowledged++;
          
          let severityClass = '';
          let severityIcon = '';
          switch(alert.severity) {
            case 3: severityClass = 'danger'; severityIcon = 'exclamation-circle'; break;
            case 2: severityClass = 'danger'; severityIcon = 'exclamation-triangle'; break;
            case 1: severityClass = 'warning'; severityIcon = 'exclamation'; break;
            default: severityClass = 'info'; severityIcon = 'info'; break;
          }
          
          html += `
            <div class="alert alert-${severityClass} alert-card">
              <i class="fas fa-${severityIcon}"></i>
              <strong>${alert.message}</strong>
              <br><small>${alert.source} - ${new Date(alert.timestamp * 1000).toLocaleString()}</small>
              ${!alert.acknowledged ? `
                <button class="btn btn-sm btn-light float-right" onclick="acknowledgeAlert(${alert.id})">
                  <i class="fas fa-check"></i> Reconocer
                </button>
              ` : `
                <span class="badge badge-success float-right">Reconocida</span>
              `}
            </div>
          `;
        });
        
        $('#alertList').html(html || '<p class="text-success">No hay alertas activas</p>');
        $('#alertCount').text(unacknowledged);
      });
    }
    
    function acknowledgeAlert(id) {
      fetch(`/api/alerts/${id}/acknowledge`, {
        method: 'POST',
        headers: { 'Authorization': 'Bearer ' + authToken }
      })
      .then(() => loadAlerts());
    }
    
    // === CONSUMO ===
    
    function loadConsumption() {
      fetch('/api/consumption/stats', {
        headers: { 'Authorization': 'Bearer ' + authToken }
      })
      .then(response => response.json())
      .then(data => {
        $('#currentPower').text(data.total_power + ' W');
        $('#consumption24h').text(data.total_energy_24h.toFixed(2) + ' kWh');
        $('#estimatedCost').text('$' + (data.total_energy_24h * 5).toFixed(2)); // $5 por kWh ejemplo
        $('#co2Emissions').text((data.total_energy_24h * 0.5).toFixed(2) + ' kg'); // 0.5 kg CO2 por kWh
      });
    }
    
    function initConsumptionChart() {
      const ctx = document.getElementById('consumptionChart').getContext('2d');
      consumptionChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Consumo (W)',
            data: [],
            borderColor: 'rgb(255, 159, 64)',
            backgroundColor: 'rgba(255, 159, 64, 0.2)',
            tension: 0.1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false
        }
      });
      
      // Actualizar cada 30 segundos
      setInterval(updateConsumptionChart, 30000);
      updateConsumptionChart();
    }
    
    function updateConsumptionChart() {
      // Simular datos de consumo
      const now = new Date();
      const label = now.getHours() + ':' + now.getMinutes();
      const value = 800 + Math.random() * 200;
      
      consumptionChart.data.labels.push(label);
      consumptionChart.data.datasets[0].data.push(value);
      
      if (consumptionChart.data.labels.length > 20) {
        consumptionChart.data.labels.shift();
        consumptionChart.data.datasets[0].data.shift();
      }
      
      consumptionChart.update();
    }
    
    // === EXPORTAR ===
    
    function exportData() {
      const type = $('#exportType').val();
      const format = $('#exportFormat').val();
      
      window.location.href = `/api/export/${type}?format=${format}&token=${authToken}`;
    }
    
    function createBackup() {
      fetch('/api/admin/backup', {
        method: 'POST',
        headers: { 'Authorization': 'Bearer ' + authToken }
      })
      .then(response => response.json())
      .then(data => {
        alert('Backup creado exitosamente');
        $('#lastBackup').text(new Date().toLocaleString());
      });
    }
    
    function restoreBackup() {
      if (confirm('¿Restaurar el último backup? Esto sobrescribirá la configuración actual.')) {
        fetch('/api/admin/restore', {
          method: 'POST',
          headers: { 'Authorization': 'Bearer ' + authToken }
        })
        .then(response => response.json())
        .then(data => {
          alert('Backup restaurado. Reiniciando sistema...');
          setTimeout(() => location.reload(), 2000);
        });
      }
    }
  </script>
</body>
</html>